{% extends "base_admin.html" %}
{% load widget_tweaks %}
{% block title %}Add Driver{% endblock %}

{% block content %}
<style>
.form-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1.25rem;
}

@media (min-width: 768px) {
  .form-grid {
    grid-template-columns: 1fr 1fr;
  }
}

/* New styles for two-column section layout */
.sections-container {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1.5rem;
  align-items: start;
}

@media (min-width: 1024px) {
  .sections-container {
    grid-template-columns: 1fr 1fr;
  }
}

.section-card {
  background: white;
  border: 1px solid #e5e7eb;
  border-radius: 0.75rem;
  padding: 1.75rem;
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
  min-height: 280px;
  display: flex;
  flex-direction: column;
  transition: box-shadow 0.2s;
}

.section-card:hover {
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.section-card .form-grid {
  flex: 1;
  display: grid;
  grid-template-columns: 1fr;
  gap: 1.25rem;
  align-content: start;
}

@media (min-width: 768px) {
  .section-card .form-grid {
    grid-template-columns: 1fr 1fr;
  }
}

/* Special handling for sections with fewer fields */
.security-section, .services-section {
  min-height: 280px;
}

.security-section .form-grid {
  grid-template-columns: 1fr !important;
}

.services-section .form-grid {
  grid-template-columns: 1fr !important;
}

@media (min-width: 768px) {
  .services-section .form-grid {
    grid-template-columns: 1fr 1fr 1fr !important;
  }
}

.full-width-section {
  grid-column: 1 / -1;
  min-height: auto;
}

.form-field {
  display: flex;
  flex-direction: column;
}

.form-input {
  width: 100%;
  padding: 0.625rem 0.875rem;
  border: 1px solid #d1d5db;
  border-radius: 0.5rem;
  font-size: 0.9375rem;
  transition: all 0.2s;
  background-color: #fafafa;
  line-height: 1.5;
}

.form-input:focus {
  outline: none;
  border-color: #14b8a6;
  box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
  background-color: #ffffff;
}

.form-input:hover {
  border-color: #9ca3af;
}

.form-label {
  display: block;
  font-weight: 600;
  color: #374151;
  margin-bottom: 0.5rem;
  font-size: 0.875rem;
  letter-spacing: 0.01em;
}

.full-width {
  grid-column: 1 / -1;
}

.section-title {
  font-size: 1.125rem;
  font-weight: 700;
  margin-bottom: 1.25rem;
  color: #1f2937;
  border-bottom: 2px solid #14b8a6;
  padding-bottom: 0.625rem;
  letter-spacing: 0.02em;
}

/* Responsive adjustments */
@media (max-width: 1023px) {
  .section-card {
    margin-bottom: 1.5rem;
  }
}

.eye-toggle {
  position: absolute;
  right: 12px;
  top: 66%;
  transform: translateY(-50%);
  cursor: pointer;
  user-select: none;
  color: #6b7280;
  z-index: 10;
  padding: 6px;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 0.25rem;
}

.eye-toggle:hover {
  color: #14b8a6;
  background-color: rgba(20, 184, 166, 0.1);
}

.eye-toggle:active {
  transform: translateY(-50%) scale(0.95);
}

.position-relative {
  position: relative;
  display: flex;
  flex-direction: column;
}

.position-relative .form-input {
  padding-right: 45px;
}

.page-header {
  margin-bottom: 2rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid #e5e7eb;
}

.btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border-radius: 0.5rem;
  font-weight: 500;
  transition: all 0.2s;
  text-decoration: none;
}

.btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

select.form-input {
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 0.75rem center;
  padding-right: 2.5rem;
}

input[type="file"].form-input {
  padding: 0.5rem 0.875rem;
  background-color: #ffffff;
  cursor: pointer;
}

input[type="file"].form-input:hover {
  background-color: #fafafa;
}

.error-container {
  animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

#password-match-msg {
  margin-top: 0.375rem;
  font-size: 0.8125rem;
  font-weight: 500;
  transition: all 0.2s;
}

.submit-button {
  padding: 0.75rem 2rem;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 0.5rem;
  box-shadow: 0 2px 4px rgba(20, 184, 166, 0.2);
  transition: all 0.2s;
}

.submit-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(20, 184, 166, 0.3);
}

.submit-button:active {
  transform: translateY(0);
}
</style>

<div class="page-header flex justify-between items-center">
  <div>
    <h1 class="text-3xl font-bold text-gray-800">Add New Driver</h1>
    <p class="text-sm text-gray-600 mt-1">Fill in the driver information below</p>
  </div>
  <a href="{% url 'admin_drivers' %}" class="btn btn-sm bg-gray-200 hover:bg-gray-300 text-gray-800">
    ← Back to Drivers
  </a>
</div>

<div class="max-w-7xl mx-auto">
<form id="add-driver-form" method="POST" enctype="multipart/form-data" novalidate>
  {% csrf_token %}
  {% if form.errors %}
    <div class="error-container mb-4 p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg full-width-section">
      <div class="font-semibold mb-2 flex items-center gap-2">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        Please correct the following errors:
      </div>
      <ul class="list-disc list-inside space-y-1">
        {% for field in form %}
          {% for error in field.errors %}
            <li><strong>{{ field.label }}:</strong> {{ error }}</li>
          {% endfor %}
        {% endfor %}
        {% for error in form.non_field_errors %}
          <li>{{ error }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  <div class="sections-container">
    <!-- Personal Info -->
    <div class="section-card">
      <h5 class="section-title">Personal Information</h5>
      <div class="form-grid">
        <div class="form-field">
          <label for="{{ form.first_name.id_for_label }}" class="form-label">
            {{ form.first_name.label }}
          </label>
          {{ form.first_name|add_class:"form-input"|attr:"required:true"|attr:"maxlength:50"|attr:"data-required:true" }}
          <small class="text-red-500 text-xs mt-1 hidden error-msg">This field is required.</small>
        </div>
        <div class="form-field">
          <label for="{{ form.last_name.id_for_label }}" class="form-label">
            {{ form.last_name.label }}
          </label>
          {{ form.last_name|add_class:"form-input"|attr:"required:true"|attr:"maxlength:50"|attr:"data-required:true" }}
          <small class="text-red-500 text-xs mt-1 hidden error-msg">This field is required.</small>
        </div>
        <div class="form-field">
          <label for="{{ form.email.id_for_label }}" class="form-label">
            {{ form.email.label }}
          </label>
          {{ form.email|add_class:"form-input"|attr:"required:true"|attr:"type:email"|attr:"data-required:true" }}
          <small class="text-red-500 text-xs mt-1 hidden error-msg">Enter a valid email address.</small>
        </div>
        <div class="form-field">
          <label for="{{ form.phone.id_for_label }}" class="form-label">
            {{ form.phone.label }}
          </label>
          {{ form.phone|add_class:"form-input"|attr:"required:true"|attr:"pattern:^[6-9][0-9]{9}$"|attr:"maxlength:10"|attr:"inputmode:numeric"|attr:"title:Enter a valid 10-digit mobile number starting with 6, 7, 8, or 9."|attr:"data-required:true" }}
          <small class="text-red-500 text-xs mt-1 hidden error-msg">Enter a valid 10-digit mobile number.</small>
        </div>
        <div class="form-field">
          <label for="{{ form.gender.id_for_label }}" class="form-label">
            {{ form.gender.label }}
          </label>
          {{ form.gender|add_class:"form-input" }}
        </div>
      </div>
    </div>

    <!-- Vehicle Details -->
    <div class="section-card">
      <h5 class="section-title">Vehicle Details</h5>
      <div class="form-grid">
        <div class="form-field">
          <label for="vehicle_type" class="form-label">Vehicle Type</label>
          <select name="vehicle_type" id="vehicle_type" class="form-input" required data-required="true">
            <option value="">Select Vehicle Type</option>
            <option value="Hatchback">Hatchback</option>
            <option value="Sedan">Sedan</option>
            <option value="SUV">SUV</option>
            <option value="Auto">Auto</option>
            <option value="Bike">Bike</option>
          </select>
          <small class="text-red-500 text-xs mt-1 hidden error-msg">This field is required.</small>
        </div>
        <div class="form-field">
          <label for="{{ form.plate_number.id_for_label }}" class="form-label">
            {{ form.plate_number.label }}
          </label>
          {{ form.plate_number|add_class:"form-input"|attr:"required:true"|attr:"maxlength:20"|attr:"data-required:true" }}
          <small class="text-red-500 text-xs mt-1 hidden error-msg">This field is required.</small>
        </div>
        <div class="form-field">
          <label for="{{ form.manufacturer.id_for_label }}" class="form-label">
            {{ form.manufacturer.label }}
          </label>
          {{ form.manufacturer|add_class:"form-input"|attr:"required:true"|attr:"maxlength:100"|attr:"data-required:true" }}
          <small class="text-red-500 text-xs mt-1 hidden error-msg">This field is required.</small>
        </div>
        <div class="form-field">
          <label for="{{ form.color.id_for_label }}" class="form-label">
            {{ form.color.label }}
          </label>
          {{ form.color|add_class:"form-input" }}
        </div>
        <div class="form-field">
          <label for="{{ form.manufacturing_year.id_for_label }}" class="form-label">
            {{ form.manufacturing_year.label }}
          </label>
          {{ form.manufacturing_year|add_class:"form-input" }}
        </div>
        <div class="form-field">
          <label for="{{ form.seat_arrangement.id_for_label }}" class="form-label">
            {{ form.seat_arrangement.label }}
          </label>
          {{ form.seat_arrangement|add_class:"form-input" }}
        </div>
      </div>
    </div>

    <!-- Location -->
    <div class="section-card">
      <h5 class="section-title">Location</h5>
      <div class="form-grid">
        <div class="form-field">
          <label for="state" class="form-label">State</label>
          <select id="state" name="state" onchange="updateCityOptions()" class="form-input">
            <option value="">Select State</option>
            <option value="Maharashtra">Maharashtra</option>
            <option value="Gujarat">Gujarat</option>
            <option value="Karnataka">Karnataka</option>
            <option value="Tamil Nadu">Tamil Nadu</option>
            <option value="Delhi">Delhi</option>
            <option value="West Bengal">West Bengal</option>
            <option value="Rajasthan">Rajasthan</option>
            <option value="Uttar Pradesh">Uttar Pradesh</option>
            <option value="Telangana">Telangana</option>
            <option value="Punjab">Punjab</option>
          </select>
        </div>
        <div class="form-field">
          <label for="city" class="form-label">City</label>
          <select id="city" name="city" class="form-input">
            <option value="">Select City</option>
          </select>
        </div>
        <div class="form-field full-width">
          <label for="{{ form.full_address.id_for_label }}" class="form-label">
            {{ form.full_address.label }}
          </label>
          {{ form.full_address|add_class:"form-input"|attr:"required:true"|attr:"data-required:true" }}
          <small class="text-red-500 text-xs mt-1 hidden error-msg">This field is required.</small>
        </div>
      </div>
    </div>

    <!-- Services -->
    <div class="section-card services-section">
      <h5 class="section-title">Services</h5>
      <div class="form-grid">
        <div class="form-field">
          <label for="daily_services" class="form-label">Daily Services</label>
          <select name="daily_services" id="daily_services" class="form-input">
            <option value="">Select</option>
            <option value="Yes" {% if form.daily_services.value == "Yes" %}selected{% endif %}>Yes</option>
            <option value="No" {% if form.daily_services.value == "No" %}selected{% endif %}>No</option>
          </select>
        </div>
        <div class="form-field">
          <label for="rental_services" class="form-label">Rental Services</label>
          <select name="rental_services" id="rental_services" class="form-input">
            <option value="">Select</option>
            <option value="Yes" {% if form.rental_services.value == "Yes" %}selected{% endif %}>Yes</option>
            <option value="No" {% if form.rental_services.value == "No" %}selected{% endif %}>No</option>
          </select>
        </div>
        <div class="form-field">
          <label for="outstation_services" class="form-label">Outstation Services</label>
          <select name="outstation_services" id="outstation_services" class="form-input">
            <option value="">Select</option>
            <option value="Yes" {% if form.outstation_services.value == "Yes" %}selected{% endif %}>Yes</option>
            <option value="No" {% if form.outstation_services.value == "No" %}selected{% endif %}>No</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Bank Details -->
    <div class="section-card">
      <h5 class="section-title">Bank Details</h5>
      <div class="form-grid">
        <div class="form-field">
          <label for="{{ form.upi_id.id_for_label }}" class="form-label">
            {{ form.upi_id.label }}
          </label>
          {{ form.upi_id|add_class:"form-input" }}
        </div>
        <div class="form-field">
          <label for="{{ form.bank_name.id_for_label }}" class="form-label">
            {{ form.bank_name.label }}
          </label>
          {{ form.bank_name|add_class:"form-input" }}
        </div>
        <div class="form-field">
          <label for="{{ form.ifsc_code.id_for_label }}" class="form-label">
            {{ form.ifsc_code.label }}
          </label>
          {{ form.ifsc_code|add_class:"form-input" }}
        </div>
        <div class="form-field">
          <label for="{{ form.account_number.id_for_label }}" class="form-label">
            {{ form.account_number.label }}
          </label>
          {{ form.account_number|add_class:"form-input" }}
        </div>
      </div>
    </div>

    <!-- Security -->
    <div class="section-card security-section">
      <h5 class="section-title">Security</h5>
      <div class="form-grid">
        <div class="form-field position-relative">
          <label for="{{ form.password_hash.id_for_label }}" class="form-label">
            Password
          </label>
          {{ form.password_hash|add_class:"form-input" }}
          <span class="eye-toggle" onclick="togglePasswordVisibility('{{ form.password_hash.id_for_label }}')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
          </span>
        </div>
        <div class="form-field position-relative">
          <label for="confirm_password" class="form-label">Confirm Password</label>
          <input type="password" id="confirm_password" class="form-input" />
          <span class="eye-toggle" onclick="togglePasswordVisibility('confirm_password')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
          </span>
          <small id="password-match-msg"></small>
        </div>
      </div>
    </div>

    <!-- Documents - Full Width -->
    <div class="section-card full-width-section">
      <h5 class="section-title">Documents</h5>
      <div class="form-grid">
        <div class="form-field">
          <label for="{{ form.license_document.id_for_label }}" class="form-label">
            {{ form.license_document.label }}
          </label>
          {{ form.license_document|add_class:"form-input"|attr:"required:true"|attr:"data-required:true" }}
          <small class="text-red-500 text-xs mt-1 hidden error-msg">License document is required.</small>
        </div>
        <div class="form-field">
          <label for="{{ form.id_proof.id_for_label }}" class="form-label">
            {{ form.id_proof.label }}
          </label>
          {{ form.id_proof|add_class:"form-input" }}
        </div>
        <div class="form-field">
          <label for="{{ form.vehicle_rc.id_for_label }}" class="form-label">
            {{ form.vehicle_rc.label }}
          </label>
          {{ form.vehicle_rc|add_class:"form-input" }}
        </div>
      </div>
    </div>
  </div>

  <div class="flex justify-end mt-8">
    <button type="submit" id="submit-driver-btn" class="submit-button px-6 py-2 bg-teal-600 text-white rounded hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 transition duration-200 disabled:opacity-60 disabled:cursor-not-allowed" disabled>
      Submit Driver Information
    </button>
  </div>
  
<script>
  function updateCityOptions() {
    const state = document.getElementById("state").value;
    const citySelect = document.getElementById("city");

    const cityMap = {
      "Maharashtra": [
        "Ahmednagar","Akola","Amravati","Aurangabad","Beed","Bhandara","Buldhana","Dhule",
        "Gondia","Hingoli","Jalgaon","Jalna","Kolhapur","Latur","Mumbai City","Mumbai Suburban",
        "Nagpur","Nanded","Nandurbar","Nashik","Palghar","Parbhani","Pune",
        "Raigad","Ratnagiri","Sangli","Satara","Sindhudurg","Solapur","Thane","Wardha",
        "Washim","Yavatmal"
      ],
      "Gujarat": [
        "Ahmedabad", "Amreli", "Anand", "Aravalli", "Banaskantha", "Bharuch", "Bhavnagar",
        "Botad", "Chhota Udaipur", "Dahod", "Dangs", "Devbhoomi Dwarka", "Gandhinagar",
        "Gir Somnath", "Jamnagar", "Junagadh", "Kheda", "Kutch", "Mahisagar", "Mehsana",
        "Morbi", "Mudra", "Narmada", "Navsari", "Panchmahal", "Patan", "Porbandar",
        "Rajkot", "Sabarkantha", "Surat", "Surendranagar", "Tapi", "Vadodara"
      ],
      "Karnataka": [
        "Bagalkot", "Bangalore Rural", "Bangalore Urban", "Belagavi", "Ballari", "Bidar",
        "Chamarajanagar", "Chikballapur", "Chikkamagaluru", "Chitradurga", "Dakshina Kannada",
        "Davangere", "Dharwad", "Gadag", "Hassan", "Haveri", "Kalaburagi", "Kodagu",
        "Kolar", "Koppal", "Mandya", "Mysuru", "Raichur", "Ramanagara", "Shivamogga",
        "Tumakuru", "Udupi", "Uttara Kannada", "Vijayapura", "Yadgir"
      ],
      "Tamil Nadu": [
        "Ariyalur", "Chengalpattu", "Chennai", "Coimbatore", "Cuddalore", "Dharmapuri",
        "Dindigul", "Erode", "Kallakurichi", "Kanchipuram", "Kanyakumari", "Karur",
        "Krishnagiri", "Madurai", "Mayiladuthurai", "Nagapattinam", "Namakkal", "Nilgiris",
        "Perambalur", "Pudukkottai", "Ramanathapuram", "Ranipet", "Salem", "Sivaganga",
        "Tenkasi", "Thanjavur", "Theni", "Thoothukudi", "Tiruchirappalli", "Tirunelveli",
        "Tirupattur", "Tiruppur", "Tiruvallur", "Tiruvannamalai", "Tiruvarur", "Vellore",
        "Viluppuram", "Virudhunagar"
      ],
      "Delhi": [
        "North", "North East", "North West", "East", "South", "South West",
        "South East", "New Delhi", "Central", "Shahdara", "West"
      ],
      "West Bengal": [
        "Alipurduar", "Bankura", "Birbhum", "Cooch Behar", "Dakshin Dinajpur", "Darjeeling",
        "Hooghly", "Howrah", "Jalpaiguri", "Jhargram", "Kalimpong", "Kolkata",
        "Malda", "Murshidabad", "Nadia", "North 24 Parganas", "Paschim Bardhaman",
        "Paschim Medinipur", "Purba Bardhaman", "Purba Medinipur", "Purulia", "South 24 Parganas",
        "Uttar Dinajpur"
      ],
      "Rajasthan": [
        "Ajmer", "Alwar", "Banswara", "Baran", "Barmer", "Bharatpur", "Bhilwara",
        "Bikaner", "Bundi", "Chittorgarh", "Churu", "Dausa", "Dholpur", "Dungarpur",
        "Hanumangarh", "Jaipur", "Jaisalmer", "Jalore", "Jhalawar", "Jhunjhunu",
        "Jodhpur", "Karauli", "Kota", "Nagaur", "Pali", "Pratapgarh", "Rajsamand",
        "Sawai Madhopur", "Sikar", "Sirohi", "Sri Ganganagar", "Tonk", "Udaipur"
      ],
      "Uttar Pradesh": [
        "Agra", "Aligarh", "Ambedkar Nagar", "Amethi", "Amroha", "Auraiya", "Azamgarh",
        "Baghpat", "Bahraich", "Ballia", "Balrampur", "Banda", "Barabanki", "Bareilly",
        "Basti", "Bhadohi", "Bijnor", "Budaun", "Bulandshahr", "Chandauli", "Chitrakoot",
        "Deoria", "Etah", "Etawah", "Farrukhabad", "Fatehpur", "Firozabad", "Gautam Buddha Nagar",
        "Ghaziabad", "Ghazipur", "Gonda", "Gorakhpur", "Hamirpur", "Hapur", "Hardoi",
        "Hathras", "Jalaun", "Jaunpur", "Jhansi", "Kannauj", "Kanpur Dehat", "Kanpur Nagar",
        "Kasganj", "Kaushambi", "Kheri", "Kushinagar", "Lakhimpur Kheri", "Lalitpur", "Lucknow",
        "Maharajganj", "Mahoba", "Mainpuri", "Mathura", "Mau", "Meerut", "Mirzapur",
        "Moradabad", "Muzaffarnagar", "Pilibhit", "Pratapgarh", "Raebareli", "Rampur",
        "Saharanpur", "Sambhal", "Sant Kabir Nagar", "Shahjahanpur", "Shamli", "Shravasti",
        "Siddharthnagar", "Sitapur", "Sonbhadra", "Sultanpur", "Unnao", "Varanasi"
      ],
      "Telangana": [
        "Adilabad", "Bhadradri Kothagudem", "Hyderabad", "Jagtial", "Jangaon", "Jayashankar Bhupalpally",
        "Jogulamba Gadwal", "Kamareddy", "Karimnagar", "Khammam", "Komaram Bheem Asifabad",
        "Mahabubabad", "Mahabubnagar", "Mancherial", "Medak", "Medchal Malkajgiri", "Nagarkurnool",
        "Nalgonda", "Narayanpet", "Nirmal", "Nizamabad", "Peddapalli", "Rajanna Sircilla", "Rangareddy",
        "Sangareddy", "Siddipet", "Suryapet", "Vikarabad", "Wanaparthy", "Warangal Rural", "Warangal Urban",
        "Yadadri Bhuvanagiri"
      ],
      "Punjab": [
        "Amritsar", "Barnala", "Bathinda", "Faridkot", "Fatehgarh Sahib", "Fazilka", "Ferozepur",
        "Gurdaspur", "Hoshiarpur", "Jalandhar", "Kapurthala", "Ludhiana", "Mansa", "Moga",
        "Muktsar", "Nawanshahr", "Pathankot", "Patiala", "Rupnagar",
        "Sangrur", "SAS Nagar", "Tarn Taran"
      ]
    };

    const cities = cityMap[state] || [];
    citySelect.innerHTML = '<option value="">Select City</option>' + 
      cities.map(city => `<option value="${city}">${city}</option>`).join('');
  }

  function togglePasswordVisibility(id) {
    const input = document.getElementById(id);
    if (input.type === "password") {
      input.type = "text";
    } else {
      input.type = "password";
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById("{{ form.password_hash.id_for_label }}");
    const confirmPasswordInput = document.getElementById("confirm_password");
    const message = document.getElementById("password-match-msg");

    function checkPasswordMatch() {
      if (passwordInput.value === "" && confirmPasswordInput.value === "") {
        message.textContent = "";
        return;
      }
      if (passwordInput.value === confirmPasswordInput.value) {
        message.textContent = "✓ Passwords match";
        message.style.color = "#059669";
      } else {
        message.textContent = "✗ Passwords do not match";
        message.style.color = "#dc2626";
      }
    }

    passwordInput.addEventListener('input', checkPasswordMatch);
    confirmPasswordInput.addEventListener('input', checkPasswordMatch);
  });

  // Client-side validation: inline errors + disable submit until valid
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('add-driver-form');
    const submitBtn = document.getElementById('submit-driver-btn');
    const requiredFields = Array.from(form.querySelectorAll('[data-required="true"]'));

    function showError(input, message) {
      input.classList.add('border-red-500');
      const msg = input.parentElement.querySelector('.error-msg');
      if (msg) {
        msg.textContent = message;
        msg.classList.remove('hidden');
      }
    }

    function clearError(input) {
      input.classList.remove('border-red-500');
      const msg = input.parentElement.querySelector('.error-msg');
      if (msg) {
        msg.classList.add('hidden');
      }
    }

    function validateField(input) {
      clearError(input);
      if (input.type === 'email' && input.required) {
        if (!input.value) {
          showError(input, 'This field is required.');
          return false;
        }
        if (!input.validity.valid) {
          showError(input, 'Enter a valid email address.');
          return false;
        }
      } else if (input.name === 'phone') {
        const val = input.value.trim();
        if (!val) {
          showError(input, 'This field is required.');
          return false;
        }
        if (!/^[6-9][0-9]{9}$/.test(val)) {
          showError(input, 'Enter a valid 10-digit mobile number starting with 6, 7, 8, or 9.');
          return false;
        }
      } else if (input.required && !input.value) {
        showError(input, 'This field is required.');
        return false;
      }
      return true;
    }

    function validateForm() {
      let allValid = true;
      requiredFields.forEach((field) => {
        const ok = validateField(field);
        if (!ok) allValid = false;
      });
      submitBtn.disabled = !allValid;
    }

    requiredFields.forEach((field) => {
      field.addEventListener('input', validateForm);
      field.addEventListener('blur', () => validateField(field));
      field.addEventListener('change', validateForm);
    });

    validateForm();
  });
</script>
    
</form>
</div>
{% endblock %}
