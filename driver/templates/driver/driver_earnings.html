{% load static %}

{% block extra_css %}
<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Fonts and Icons -->
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Raleway:wght@400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link rel="stylesheet" href="{% static 'passenger/css/global.css' %}">
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
  <div class="mb-6">
    <a href="{% url 'driver_homepage' %}" class="inline-block px-4 py-2 bg-[#1BBC9B] text-white font-medium rounded hover:bg-teal-600 transition">
      ← Back to Homepage
    </a>
  </div>
  <h2 class="text-2xl font-semibold text-gray-800 mb-6">Earnings Summary</h2>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- Today's Earnings -->
    <div class="bg-white shadow rounded-lg p-6 border border-gray-200">
      <h3 class="text-lg font-medium text-gray-700 mb-2">Today</h3>
      <!-- Corrected variable name from today_earnings to earnings_today -->
      <p class="text-3xl font-semibold text-green-600">₹{{ earnings_today }}</p>
    </div>

    <!-- This Month's Earnings -->
    <div class="bg-white shadow rounded-lg p-6 border border-gray-200">
      <h3 class="text-lg font-medium text-gray-700 mb-2">This Month</h3>
      <!-- Corrected variable name from monthly_earnings to earnings_month -->
      <p class="text-3xl font-semibold text-blue-600">₹{{ earnings_month }}</p>
    </div>

    <!-- This Year's Earnings -->
    <div class="bg-white shadow rounded-lg p-6 border border-gray-200">
      <h3 class="text-lg font-medium text-gray-700 mb-2">This Year</h3>
      <!-- Corrected variable name from yearly_earnings to earnings_year -->
      <p class="text-3xl font-semibold text-purple-600">₹{{ earnings_year }}</p>
    </div>
  </div>

  <div class="mt-10">
    <h3 class="text-xl font-semibold text-gray-800 mb-4">Ride Earnings Breakdown</h3>
    <div class="overflow-x-auto bg-white rounded-lg shadow border border-gray-200">
      <table class="min-w-full text-sm text-left text-gray-700">
        <thead class="bg-gray-100 text-xs uppercase font-semibold text-gray-600">
          <tr>
            <th class="px-6 py-3">Ride ID</th>
            <th class="px-6 py-3">Pickup</th>
            <th class="px-6 py-3">Dropoff</th>
            <th class="px-6 py-3">Date & Time</th>
            <th class="px-6 py-3">Fare (₹)</th>
            <th class="px-6 py-3">Driver Earning (₹)</th>
          </tr>
        </thead>
        <tbody>
          {% for ride in ride_earnings %}
          <tr class="border-b hover:bg-gray-50">
            <td class="px-6 py-4">{{ ride.booking_id }}</td>
            <td class="px-6 py-4">{{ ride.pickup_location }}</td>
            <td class="px-6 py-4">{{ ride.dropoff_location }}</td>
            <!-- Using a Django filter to format the datetime object from the view -->
            <td class="px-6 py-4">{{ ride.scheduled_time|date:"Y-m-d" }} {{ ride.scheduled_time|time:"H:i" }}</td>
            <td class="px-6 py-4">₹{{ ride.fare }}</td>
            <td class="px-6 py-4">₹{{ ride.driver_earning }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="px-6 py-4 text-center text-gray-500">No completed rides found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
